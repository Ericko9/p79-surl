<!-- Navbar Dashboard (untuk halaman selain /login dan /register) -->
<nav id="navbar-dashboard" class="fixed top-0 left-0 right-0 w-full z-50 bg-gray-100">
  <div class="w-full" style="max-width: 100%;">
    <div class="bg-white rounded-lg shadow-sm px-6">
      <div class="flex items-center justify-between px-4 h-16">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2">
          <img
            src="/images/Logo.png"
            alt="URL Shortener"
            class="w-[218px] h-[49px]"
          />
        </a>

        <!-- Navigation Menu -->
        <div class="flex items-center gap-6">
          <a
            href="/index"
            id="nav-dashboard"
            class="relative inline-flex items-center text-gray-500 font-medium text-base transition-colors"
          >
            Dashboard
          </a>
          <a 
            href="/link" 
            id="nav-link"
            class="relative inline-flex items-center gap-2 text-gray-500 font-medium text-base transition-colors"
          >
            Links
            <span id="link-badge" class="hidden bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full min-w-[32px] text-center">0</span>
          </a>
        </div>

        <!-- User Profile -->
        <div class="relative w-[200px]">
          <!-- Trigger -->
          <button
            id="user-menu-button"
            type="button"
            class="flex items-center gap-3 w-full focus:outline-none"
          >
            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">
              <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
        
            <div class="flex flex-col items-start">
              <span id="username-display" class="text-sm font-medium text-gray-700">Loading...</span>
              <span class="text-xs bg-green-500 text-white px-2 py-0.5 rounded-full w-fit">
                Online
              </span>
            </div>
        
            <svg class="w-4 h-4 text-gray-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        
          <!-- Dropdown -->
          <div
            id="user-menu"
            class="absolute right-0 mt-3 w-48 bg-white rounded-lg shadow-lg border hidden z-50"
          >
            <a
              href="/profile"
              class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
            >
              Profile
            </a>

            <div class="border-t my-1"></div>
        
            <a
              href="/logout"
              class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100"
            >
              Logout
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Navbar Login/Register (untuk halaman /login dan /register) -->
<nav id="navbar-auth" class="fixed top-0 left-0 right-0 w-full z-50 bg-white shadow-sm" style="display: none; position: fixed; width: 100%; left: 0; right: 0; margin: 0; padding: 0;">
  <div class="w-full px-6 lg:px-8" style="max-width: 100%;">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3">
        <img
          src="/images/Logo.png"
          alt="URL Shortener"
          class="w-[218px] h-[49px]"
        />
      </a>

      <!-- Right Side: Language, Sign Up, Login -->
      <div class="flex items-center gap-4">
        <!-- Language Dropdown (optional) -->
        <div class="flex items-center gap-2 px-3 py-2 rounded-lg 
                hover:bg-blue-100 cursor-pointer transition-colors">
        <span class="text-sm font-medium text-blue-600">English</span>
        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" 
          viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M19 9l-7 7-7-7"></path>
        </svg>
        </div>


        <!-- Sign Up Button -->
        <a
          href="/register"
          class="h-10 px-4 rounded-full bg-[#E6F6F8] text-[#1A73E8] text-sm font-medium hover:bg-[#D9F1F4] transition-colors flex items-center justify-center w-[116px]"
          >
          Sign Up
        </a>

        <!-- Login Button -->
        <a
        href="/login"
        class="h-10 px-4 rounded-full bg-[#0B78D1] text-white text-sm font-medium hover:bg-[#0969B5] transition-colors flex items-center justify-center gap-2 w-[129px]"
      >
        Login
        <span class="flex items-center justify-center w-5 h-5 bg-white rounded-full">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3 text-[#0B78D1]"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M5 12h12" />
            <path d="M13 6l6 6-6 6" />
          </svg>
        </span>
      </a>
      </div>
    </div>
  </div>
</nav>

<script>
  // ========== NAVBAR VISIBILITY ==========
  (function() {
    var currentPath = window.location.pathname;
    var isLoginOrRegister = currentPath === '/' || currentPath === '/register' || currentPath === '/login' || currentPath === '/resetpassword' || currentPath === '/Register';
    
    var navbarDashboard = document.getElementById('navbar-dashboard');
    var navbarAuth = document.getElementById('navbar-auth');
    
    if (isLoginOrRegister) {
      if (navbarAuth) navbarAuth.style.display = 'block';
      if (navbarDashboard) navbarDashboard.style.display = 'none';
    } else {
      if (navbarDashboard) navbarDashboard.style.display = 'block';
      if (navbarAuth) navbarAuth.style.display = 'none';
    }
  })();

  // ========== ACTIVE TAB HIGHLIGHTING ==========
  (function() {
    const currentPath = window.location.pathname;
    const navDashboard = document.getElementById('nav-dashboard');
    const navLink = document.getElementById('nav-link');
    const navAbout = document.getElementById('nav-about');
    
    // Remove all active classes first
    [navDashboard, navLink, navAbout].forEach(nav => {
      if (nav) {
        nav.classList.remove('text-blue-600', 'font-semibold');
        nav.classList.add('text-gray-500', 'font-medium');
        // Remove underline if exists
        const underline = nav.querySelector('.nav-underline');
        if (underline) underline.remove();
      }
    });
    
    // Function to add active state
    function setActive(nav) {
      if (nav) {
        nav.classList.remove('text-gray-500', 'font-medium');
        nav.classList.add('text-blue-600', 'font-semibold');
        // Add blue underline
        if (!nav.querySelector('.nav-underline')) {
          const underline = document.createElement('span');
          underline.className = 'nav-underline absolute bottom-[-20px] left-0 right-0 h-0.5 bg-blue-600';
          nav.appendChild(underline);
        }
      }
    }
    
    // Add active class based on current path
    if (currentPath === '/' || currentPath === '/index') {
      setActive(navDashboard);
    } else if (currentPath === '/link' || currentPath.startsWith('/link')) {
      setActive(navLink);
    } else if (currentPath === '/about' || currentPath.startsWith('/about')) {
      setActive(navAbout);
    }
  })();

  // ========== USER DROPDOWN & LINK COUNT ==========
  (function() {
    const USER_API_URL = 'http://localhost:8000/api/v1/users/profile';
    const LINKS_API_URL = 'http://localhost:8000/api/v1/links/my-links';
    const userMenuButton = document.getElementById('user-menu-button');
    const userMenu = document.getElementById('user-menu');
    const usernameDisplay = document.getElementById('username-display');
    const linkBadge = document.getElementById('link-badge');

    // Check if elements exist (only on dashboard pages)
    if (!userMenuButton || !userMenu || !usernameDisplay) return;

    // Toggle dropdown
    userMenuButton.addEventListener('click', (e) => {
      e.stopPropagation();
      userMenu.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userMenuButton.contains(e.target) && !userMenu.contains(e.target)) {
        userMenu.classList.add('hidden');
      }
    });

    // Fetch user profile data
    async function loadUserProfile() {
      try {
        const response = await fetch(USER_API_URL);
        
        if (!response.ok) {
          throw new Error('Failed to fetch user profile');
        }
        
        const result = await response.json();
        
        if (result.status && result.data) {
          usernameDisplay.textContent = result.data.username;
        } else {
          usernameDisplay.textContent = 'User';
        }
      } catch (error) {
        console.error('Error loading user profile:', error);
        usernameDisplay.textContent = 'User';
      }
    }

    // Fetch link count
    async function loadLinkCount() {
      if (!linkBadge) return;
      
      try {
        const response = await fetch(LINKS_API_URL);
        
        if (!response.ok) {
          throw new Error('Failed to fetch links');
        }
        
        const result = await response.json();
        
        if (result.status && result.data) {
          const linkCount = result.data.length;
          linkBadge.textContent = linkCount;
          linkBadge.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading link count:', error);
      }
    }

    // Load user profile and link count when page loads
    loadUserProfile();
    loadLinkCount();
  })();

  // ========== LANGUAGE SWITCHER ==========
  (function() {
    const langButton = document.querySelector('#navbar-auth .cursor-pointer');
    const langText = langButton?.querySelector('span');
    
    if (!langButton || !langText) return;
    
    // Buat dropdown menu
    const langMenu = document.createElement('div');
    langMenu.className = 'absolute top-full mt-2 bg-white rounded-lg shadow-lg border hidden z-50';
    langMenu.innerHTML = `
      <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-lang="en">English</a>
      <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-lang="id">Indonesia</a>
    `;
    
    // Tambahkan position relative ke parent
    langButton.style.position = 'relative';
    langButton.appendChild(langMenu);
    
    // Toggle dropdown
    langButton.addEventListener('click', (e) => {
      e.stopPropagation();
      langMenu.classList.toggle('hidden');
    });
    
    // Pilih bahasa
    langMenu.addEventListener('click', (e) => {
      e.preventDefault();
      const target = e.target.closest('[data-lang]');
      if (target) {
        const lang = target.dataset.lang;
        langText.textContent = lang === 'en' ? 'English' : 'Indonesia';
        langMenu.classList.add('hidden');
        
        // Simpan pilihan bahasa
        localStorage.setItem('language', lang);
        
        // Optional: Reload page atau update text
        console.log('Language changed to:', lang);
      }
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', () => {
      langMenu.classList.add('hidden');
    });
    
    // Load saved language
    const savedLang = localStorage.getItem('language');
    if (savedLang) {
      langText.textContent = savedLang === 'en' ? 'English' : 'Indonesia';
    }
  })();
</script>